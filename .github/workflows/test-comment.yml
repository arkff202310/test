name: Test Comment Trigger

on:
  issue_comment:
    types: [ created ]  # Only trigger on PR comments with @tester test

jobs:
  test_job:
    name: Test Job
    # Only run on PR comments that mention @tester test
    if: |
      github.event_name == 'issue_comment' &&
      github.event.issue.pull_request &&
      contains(github.event.comment.body, '@tester test')
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
      issues: read
    
    steps:
    - name: Debug event context
      run: |
        echo "Event name: ${{ github.event_name }}"
        echo "GitHub ref: ${{ github.ref }}"
        echo "PR number: ${{ github.event.issue.number }}"
        echo "Is PR: ${{ github.event.issue.pull_request }}"

    - name: Checkout repository
      uses: actions/checkout@v6
    
    - name: Debug checkout result
      run: |
        echo "Current branch: $(git branch --show-current)"
        echo "Current SHA: $(git rev-parse HEAD)"
        echo "Git log (last 3 commits):"
        git log --oneline -3
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Run main.js
      run: node main.js
